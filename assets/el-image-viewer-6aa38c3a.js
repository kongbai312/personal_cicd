import{k as me,a1 as X,a2 as pe,aH as ce,d as se,cy as ve,cz as Ie,cA as ze,v as ge,h as ye,aB as _e,s as b,cB as Le,aF as Se,q as g,U as ue,a8 as we,o as be,b as w,i as de,y as u,w as _,e as y,B as d,f as a,ay as fe,A as Ce,D as L,E as N,F as Ee,c as E,Z as te,aJ as Ne,R as xe,cC as Oe,bx as Te,ax as Ae,cD as $e,cE as Be,ae as Ve,z as Re,G as Me,r as ae,T as Ye,H as De,j as ke,J as $,bV as B,cF as Fe,I as he,b9 as He,at as P,C as Pe,m as Xe,c9 as je,Y as Ke,cG as Ge}from"./index-db3bc910.js";import{t as ie}from"./throttle-d9a145ec.js";import{u as We}from"./index-c818adb1.js";import{i as Ze}from"./position-650cd6ba.js";import{a as qe}from"./scroll-e59f85c1.js";const Je=me({urlList:{type:X(Array),default:()=>pe([])},zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},hideOnClickModal:Boolean,teleported:Boolean,closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2},minScale:{type:Number,default:.2},maxScale:{type:Number,default:7},crossorigin:{type:X(String)}}),Ue={close:()=>!0,switch:m=>ce(m),rotate:m=>ce(m)},Qe=["src","crossorigin"],ea=se({name:"ElImageViewer"}),aa=se({...ea,props:Je,emits:Ue,setup(m,{expose:x,emit:f}){var V;const c=m,p={CONTAIN:{name:"contain",icon:ve(Ie)},ORIGINAL:{name:"original",icon:ve(ze)}},{t:ne}=ge(),l=ye("image-viewer"),{nextZIndex:R}=_e(),S=b(),C=b([]),O=Le(),k=b(!0),r=b(c.initialIndex),T=Se(p.CONTAIN),n=b({scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}),M=b((V=c.zIndex)!=null?V:R()),oe=g(()=>{const{urlList:t}=c;return t.length<=1}),j=g(()=>r.value===0),K=g(()=>r.value===c.urlList.length-1),Y=g(()=>c.urlList[r.value]),le=g(()=>[l.e("btn"),l.e("prev"),l.is("disabled",!c.infinite&&j.value)]),G=g(()=>[l.e("btn"),l.e("next"),l.is("disabled",!c.infinite&&K.value)]),D=g(()=>{const{scale:t,deg:s,offsetX:o,offsetY:h,enableTransition:z}=n.value;let v=o/t,I=h/t;switch(s%360){case 90:case-270:[v,I]=[I,-v];break;case 180:case-180:[v,I]=[-v,-I];break;case 270:case-90:[v,I]=[-I,v];break}const A={transform:`scale(${t}) rotate(${s}deg) translate(${v}px, ${I}px)`,transition:z?"transform .3s":""};return T.value.name===p.CONTAIN.name&&(A.maxWidth=A.maxHeight="100%"),A});function F(){W(),f("close")}function re(){const t=ie(o=>{switch(o.code){case $.esc:c.closeOnPressEscape&&F();break;case $.space:Q();break;case $.left:ee();break;case $.up:i("zoomIn");break;case $.right:e();break;case $.down:i("zoomOut");break}}),s=ie(o=>{const h=o.deltaY||o.deltaX;i(h<0?"zoomIn":"zoomOut",{zoomRate:c.zoomRate,enableTransition:!1})});O.run(()=>{B(document,"keydown",t),B(document,"wheel",s)})}function W(){O.stop()}function Z(){k.value=!1}function q(t){k.value=!1,t.target.alt=ne("el.image.error")}function J(t){if(k.value||t.button!==0||!S.value)return;n.value.enableTransition=!1;const{offsetX:s,offsetY:o}=n.value,h=t.pageX,z=t.pageY,v=ie(A=>{n.value={...n.value,offsetX:s+A.pageX-h,offsetY:o+A.pageY-z}}),I=B(document,"mousemove",v);B(document,"mouseup",()=>{I()}),t.preventDefault()}function U(){n.value={scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}}function Q(){if(k.value)return;const t=Fe(p),s=Object.values(p),o=T.value.name,z=(s.findIndex(v=>v.name===o)+1)%t.length;T.value=p[t[z]],U()}function H(t){const s=c.urlList.length;r.value=(t+s)%s}function ee(){j.value&&!c.infinite||H(r.value-1)}function e(){K.value&&!c.infinite||H(r.value+1)}function i(t,s={}){if(k.value)return;const{minScale:o,maxScale:h}=c,{zoomRate:z,rotateDeg:v,enableTransition:I}={zoomRate:c.zoomRate,rotateDeg:90,enableTransition:!0,...s};switch(t){case"zoomOut":n.value.scale>o&&(n.value.scale=Number.parseFloat((n.value.scale/z).toFixed(3)));break;case"zoomIn":n.value.scale<h&&(n.value.scale=Number.parseFloat((n.value.scale*z).toFixed(3)));break;case"clockwise":n.value.deg+=v,f("rotate",n.value.deg);break;case"anticlockwise":n.value.deg-=v,f("rotate",n.value.deg);break}n.value.enableTransition=I}return ue(Y,()=>{we(()=>{const t=C.value[0];t!=null&&t.complete||(k.value=!0)})}),ue(r,t=>{U(),f("switch",t)}),be(()=>{var t,s;re(),(s=(t=S.value)==null?void 0:t.focus)==null||s.call(t)}),x({setActiveItem:H}),(t,s)=>(w(),de(De,{to:"body",disabled:!t.teleported},[u(Ye,{name:"viewer-fade",appear:""},{default:_(()=>[y("div",{ref_key:"wrapper",ref:S,tabindex:-1,class:d(a(l).e("wrapper")),style:fe({zIndex:M.value})},[y("div",{class:d(a(l).e("mask")),onClick:s[0]||(s[0]=Ce(o=>t.hideOnClickModal&&F(),["self"]))},null,2),L(" CLOSE "),y("span",{class:d([a(l).e("btn"),a(l).e("close")]),onClick:F},[u(a(N),null,{default:_(()=>[u(a(Ee))]),_:1})],2),L(" ARROW "),a(oe)?L("v-if",!0):(w(),E(te,{key:0},[y("span",{class:d(a(le)),onClick:ee},[u(a(N),null,{default:_(()=>[u(a(Ne))]),_:1})],2),y("span",{class:d(a(G)),onClick:e},[u(a(N),null,{default:_(()=>[u(a(xe))]),_:1})],2)],64)),L(" ACTIONS "),y("div",{class:d([a(l).e("btn"),a(l).e("actions")])},[y("div",{class:d(a(l).e("actions__inner"))},[u(a(N),{onClick:s[1]||(s[1]=o=>i("zoomOut"))},{default:_(()=>[u(a(Oe))]),_:1}),u(a(N),{onClick:s[2]||(s[2]=o=>i("zoomIn"))},{default:_(()=>[u(a(Te))]),_:1}),y("i",{class:d(a(l).e("actions__divider"))},null,2),u(a(N),{onClick:Q},{default:_(()=>[(w(),de(Ae(a(T).icon)))]),_:1}),y("i",{class:d(a(l).e("actions__divider"))},null,2),u(a(N),{onClick:s[3]||(s[3]=o=>i("anticlockwise"))},{default:_(()=>[u(a($e))]),_:1}),u(a(N),{onClick:s[4]||(s[4]=o=>i("clockwise"))},{default:_(()=>[u(a(Be))]),_:1})],2)],2),L(" CANVAS "),y("div",{class:d(a(l).e("canvas"))},[(w(!0),E(te,null,Ve(t.urlList,(o,h)=>Re((w(),E("img",{ref_for:!0,ref:z=>C.value[h]=z,key:o,src:o,style:fe(a(D)),class:d(a(l).e("img")),crossorigin:t.crossorigin,onLoad:Z,onError:q,onMousedown:J},null,46,Qe)),[[Me,h===r.value]])),128))],2),ae(t.$slots,"default")],6)]),_:3})],8,["disabled"]))}});var ta=ke(aa,[["__file","image-viewer.vue"]]);const sa=he(ta),na=me({hideOnClickModal:Boolean,src:{type:String,default:""},fit:{type:String,values:["","contain","cover","fill","none","scale-down"],default:""},loading:{type:String,values:["eager","lazy"]},lazy:Boolean,scrollContainer:{type:X([String,Object])},previewSrcList:{type:X(Array),default:()=>pe([])},previewTeleported:Boolean,zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2},minScale:{type:Number,default:.2},maxScale:{type:Number,default:7},crossorigin:{type:X(String)}}),oa={load:m=>m instanceof Event,error:m=>m instanceof Event,switch:m=>ce(m),close:()=>!0,show:()=>!0},la=["src","loading","crossorigin"],ra={key:0},ia=se({name:"ElImage",inheritAttrs:!1}),ca=se({...ia,props:na,emits:oa,setup(m,{emit:x}){const f=m;let V="";const{t:c}=ge(),p=ye("image"),ne=He(),l=We(),R=b(),S=b(!1),C=b(!0),O=b(!1),k=b(),r=b(),T=P&&"loading"in HTMLImageElement.prototype;let n,M;const oe=g(()=>[p.e("inner"),Y.value&&p.e("preview"),C.value&&p.is("loading")]),j=g(()=>ne.style),K=g(()=>{const{fit:e}=f;return P&&e?{objectFit:e}:{}}),Y=g(()=>{const{previewSrcList:e}=f;return Array.isArray(e)&&e.length>0}),le=g(()=>{const{previewSrcList:e,initialIndex:i}=f;let t=i;return i>e.length-1&&(t=0),t}),G=g(()=>f.loading==="eager"?!1:!T&&f.loading==="lazy"||f.lazy),D=()=>{P&&(C.value=!0,S.value=!1,R.value=f.src)};function F(e){C.value=!1,S.value=!1,x("load",e)}function re(e){C.value=!1,S.value=!0,x("error",e)}function W(){Ze(k.value,r.value)&&(D(),J())}const Z=Ge(W,200,!0);async function q(){var e;if(!P)return;await we();const{scrollContainer:i}=f;je(i)?r.value=i:Ke(i)&&i!==""?r.value=(e=document.querySelector(i))!=null?e:void 0:k.value&&(r.value=qe(k.value)),r.value&&(n=B(r,"scroll",Z),setTimeout(()=>W(),100))}function J(){!P||!r.value||!Z||(n==null||n(),r.value=void 0)}function U(e){if(e.ctrlKey){if(e.deltaY<0)return e.preventDefault(),!1;if(e.deltaY>0)return e.preventDefault(),!1}}function Q(){Y.value&&(M=B("wheel",U,{passive:!1}),V=document.body.style.overflow,document.body.style.overflow="hidden",O.value=!0,x("show"))}function H(){M==null||M(),document.body.style.overflow=V,O.value=!1,x("close")}function ee(e){x("switch",e)}return ue(()=>f.src,()=>{G.value?(C.value=!0,S.value=!1,J(),q()):D()}),be(()=>{G.value?q():D()}),(e,i)=>(w(),E("div",{ref_key:"container",ref:k,class:d([a(p).b(),e.$attrs.class]),style:fe(a(j))},[S.value?ae(e.$slots,"error",{key:0},()=>[y("div",{class:d(a(p).e("error"))},Pe(a(c)("el.image.error")),3)]):(w(),E(te,{key:1},[R.value!==void 0?(w(),E("img",Xe({key:0},a(l),{src:R.value,loading:e.loading,style:a(K),class:a(oe),crossorigin:e.crossorigin,onClick:Q,onLoad:F,onError:re}),null,16,la)):L("v-if",!0),C.value?(w(),E("div",{key:1,class:d(a(p).e("wrapper"))},[ae(e.$slots,"placeholder",{},()=>[y("div",{class:d(a(p).e("placeholder"))},null,2)])],2)):L("v-if",!0)],64)),a(Y)?(w(),E(te,{key:2},[O.value?(w(),de(a(sa),{key:0,"z-index":e.zIndex,"initial-index":a(le),infinite:e.infinite,"zoom-rate":e.zoomRate,"min-scale":e.minScale,"max-scale":e.maxScale,"url-list":e.previewSrcList,crossorigin:e.crossorigin,"hide-on-click-modal":e.hideOnClickModal,teleported:e.previewTeleported,"close-on-press-escape":e.closeOnPressEscape,onClose:H,onSwitch:ee},{default:_(()=>[e.$slots.viewer?(w(),E("div",ra,[ae(e.$slots,"viewer")])):L("v-if",!0)]),_:3},8,["z-index","initial-index","infinite","zoom-rate","min-scale","max-scale","url-list","crossorigin","hide-on-click-modal","teleported","close-on-press-escape"])):L("v-if",!0)],64)):L("v-if",!0)],6))}});var ua=ke(ca,[["__file","image.vue"]]);const ga=he(ua);export{ga as E};
