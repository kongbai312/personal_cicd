import{l as ve,a0 as ie,a1 as me,aF as U,d as ee,ck as fe,cl as he,cm as Ie,v as pe,i as ge,az as _e,s as k,cn as ze,aD as Le,q as f,U as ue,a6 as we,o as ye,b as w,j as ce,z as i,w as _,e as g,C as u,f as t,aw as de,B as Ce,F as z,E as x,n as Se,c as S,Z as Q,aH as Ee,R as xe,co as Ne,bp as Oe,av as Te,cp as $e,cq as Ae,ab as Re,A as Ve,G as Be,r as J,T as Me,H as Ye,k as be,J as V,bL as B,cr as De,I as ke,b3 as Xe,ar as F,D as Fe,m as He,bX as Pe,Y as je,cs as Ke}from"./index-0fd51d52.js";import{t as re}from"./throttle-22ff694f.js";import{u as Ze}from"./index-79935a9f.js";import{i as qe}from"./position-cbbafd09.js";import{a as We}from"./scroll-7b3bea3e.js";const Ge=ve({urlList:{type:ie(Array),default:()=>me([])},zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},hideOnClickModal:Boolean,teleported:Boolean,closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2},minScale:{type:Number,default:.2},maxScale:{type:Number,default:7}}),Je={close:()=>!0,switch:v=>U(v),rotate:v=>U(v)},Ue=["src"],Qe=ee({name:"ElImageViewer"}),ea=ee({...Qe,props:Ge,emits:Je,setup(v,{expose:N,emit:c}){const r=v,O={CONTAIN:{name:"contain",icon:fe(he)},ORIGINAL:{name:"original",icon:fe(Ie)}},{t:L}=pe(),l=ge("image-viewer"),{nextZIndex:ae}=_e(),T=k(),E=k([]),C=ze(),h=k(!0),m=k(r.initialIndex),p=Le(O.CONTAIN),o=k({scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}),M=f(()=>{const{urlList:a}=r;return a.length<=1}),A=f(()=>m.value===0),H=f(()=>m.value===r.urlList.length-1),te=f(()=>r.urlList[m.value]),ne=f(()=>[l.e("btn"),l.e("prev"),l.is("disabled",!r.infinite&&A.value)]),Y=f(()=>[l.e("btn"),l.e("next"),l.is("disabled",!r.infinite&&H.value)]),se=f(()=>{const{scale:a,deg:n,offsetX:s,offsetY:y,enableTransition:I}=o.value;let d=s/a,b=y/a;switch(n%360){case 90:case-270:[d,b]=[b,-d];break;case 180:case-180:[d,b]=[-d,-b];break;case 270:case-90:[d,b]=[-b,d];break}const R={transform:`scale(${a}) rotate(${n}deg) translate(${d}px, ${b}px)`,transition:I?"transform .3s":""};return p.value.name===O.CONTAIN.name&&(R.maxWidth=R.maxHeight="100%"),R}),P=f(()=>U(r.zIndex)?r.zIndex:ae());function $(){oe(),c("close")}function le(){const a=re(s=>{switch(s.code){case V.esc:r.closeOnPressEscape&&$();break;case V.space:q();break;case V.left:W();break;case V.up:e("zoomIn");break;case V.right:G();break;case V.down:e("zoomOut");break}}),n=re(s=>{const y=s.deltaY||s.deltaX;e(y<0?"zoomIn":"zoomOut",{zoomRate:r.zoomRate,enableTransition:!1})});C.run(()=>{B(document,"keydown",a),B(document,"wheel",n)})}function oe(){C.stop()}function j(){h.value=!1}function K(a){h.value=!1,a.target.alt=L("el.image.error")}function Z(a){if(h.value||a.button!==0||!T.value)return;o.value.enableTransition=!1;const{offsetX:n,offsetY:s}=o.value,y=a.pageX,I=a.pageY,d=re(R=>{o.value={...o.value,offsetX:n+R.pageX-y,offsetY:s+R.pageY-I}}),b=B(document,"mousemove",d);B(document,"mouseup",()=>{b()}),a.preventDefault()}function D(){o.value={scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}}function q(){if(h.value)return;const a=De(O),n=Object.values(O),s=p.value.name,I=(n.findIndex(d=>d.name===s)+1)%a.length;p.value=O[a[I]],D()}function X(a){const n=r.urlList.length;m.value=(a+n)%n}function W(){A.value&&!r.infinite||X(m.value-1)}function G(){H.value&&!r.infinite||X(m.value+1)}function e(a,n={}){if(h.value)return;const{minScale:s,maxScale:y}=r,{zoomRate:I,rotateDeg:d,enableTransition:b}={zoomRate:r.zoomRate,rotateDeg:90,enableTransition:!0,...n};switch(a){case"zoomOut":o.value.scale>s&&(o.value.scale=Number.parseFloat((o.value.scale/I).toFixed(3)));break;case"zoomIn":o.value.scale<y&&(o.value.scale=Number.parseFloat((o.value.scale*I).toFixed(3)));break;case"clockwise":o.value.deg+=d,c("rotate",o.value.deg);break;case"anticlockwise":o.value.deg-=d,c("rotate",o.value.deg);break}o.value.enableTransition=b}return ue(te,()=>{we(()=>{const a=E.value[0];a!=null&&a.complete||(h.value=!0)})}),ue(m,a=>{D(),c("switch",a)}),ye(()=>{var a,n;le(),(n=(a=T.value)==null?void 0:a.focus)==null||n.call(a)}),N({setActiveItem:X}),(a,n)=>(w(),ce(Ye,{to:"body",disabled:!a.teleported},[i(Me,{name:"viewer-fade",appear:""},{default:_(()=>[g("div",{ref_key:"wrapper",ref:T,tabindex:-1,class:u(t(l).e("wrapper")),style:de({zIndex:t(P)})},[g("div",{class:u(t(l).e("mask")),onClick:n[0]||(n[0]=Ce(s=>a.hideOnClickModal&&$(),["self"]))},null,2),z(" CLOSE "),g("span",{class:u([t(l).e("btn"),t(l).e("close")]),onClick:$},[i(t(x),null,{default:_(()=>[i(t(Se))]),_:1})],2),z(" ARROW "),t(M)?z("v-if",!0):(w(),S(Q,{key:0},[g("span",{class:u(t(ne)),onClick:W},[i(t(x),null,{default:_(()=>[i(t(Ee))]),_:1})],2),g("span",{class:u(t(Y)),onClick:G},[i(t(x),null,{default:_(()=>[i(t(xe))]),_:1})],2)],64)),z(" ACTIONS "),g("div",{class:u([t(l).e("btn"),t(l).e("actions")])},[g("div",{class:u(t(l).e("actions__inner"))},[i(t(x),{onClick:n[1]||(n[1]=s=>e("zoomOut"))},{default:_(()=>[i(t(Ne))]),_:1}),i(t(x),{onClick:n[2]||(n[2]=s=>e("zoomIn"))},{default:_(()=>[i(t(Oe))]),_:1}),g("i",{class:u(t(l).e("actions__divider"))},null,2),i(t(x),{onClick:q},{default:_(()=>[(w(),ce(Te(t(p).icon)))]),_:1}),g("i",{class:u(t(l).e("actions__divider"))},null,2),i(t(x),{onClick:n[3]||(n[3]=s=>e("anticlockwise"))},{default:_(()=>[i(t($e))]),_:1}),i(t(x),{onClick:n[4]||(n[4]=s=>e("clockwise"))},{default:_(()=>[i(t(Ae))]),_:1})],2)],2),z(" CANVAS "),g("div",{class:u(t(l).e("canvas"))},[(w(!0),S(Q,null,Re(a.urlList,(s,y)=>Ve((w(),S("img",{ref_for:!0,ref:I=>E.value[y]=I,key:s,src:s,style:de(t(se)),class:u(t(l).e("img")),onLoad:j,onError:K,onMousedown:Z},null,46,Ue)),[[Be,y===m.value]])),128))],2),J(a.$slots,"default")],6)]),_:3})],8,["disabled"]))}});var aa=be(ea,[["__file","image-viewer.vue"]]);const ta=ke(aa),na=ve({hideOnClickModal:Boolean,src:{type:String,default:""},fit:{type:String,values:["","contain","cover","fill","none","scale-down"],default:""},loading:{type:String,values:["eager","lazy"]},lazy:Boolean,scrollContainer:{type:ie([String,Object])},previewSrcList:{type:ie(Array),default:()=>me([])},previewTeleported:Boolean,zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2},minScale:{type:Number,default:.2},maxScale:{type:Number,default:7}}),sa={load:v=>v instanceof Event,error:v=>v instanceof Event,switch:v=>U(v),close:()=>!0,show:()=>!0},la=["src","loading"],oa={key:0},ra=ee({name:"ElImage",inheritAttrs:!1}),ia=ee({...ra,props:na,emits:sa,setup(v,{emit:N}){const c=v;let r="";const{t:O}=pe(),L=ge("image"),l=Xe(),ae=Ze(),T=k(),E=k(!1),C=k(!0),h=k(!1),m=k(),p=k(),o=F&&"loading"in HTMLImageElement.prototype;let M,A;const H=f(()=>[L.e("inner"),Y.value&&L.e("preview"),C.value&&L.is("loading")]),te=f(()=>l.style),ne=f(()=>{const{fit:e}=c;return F&&e?{objectFit:e}:{}}),Y=f(()=>{const{previewSrcList:e}=c;return Array.isArray(e)&&e.length>0}),se=f(()=>{const{previewSrcList:e,initialIndex:a}=c;let n=a;return a>e.length-1&&(n=0),n}),P=f(()=>c.loading==="eager"?!1:!o&&c.loading==="lazy"||c.lazy),$=()=>{F&&(C.value=!0,E.value=!1,T.value=c.src)};function le(e){C.value=!1,E.value=!1,N("load",e)}function oe(e){C.value=!1,E.value=!0,N("error",e)}function j(){qe(m.value,p.value)&&($(),D())}const K=Ke(j,200,!0);async function Z(){var e;if(!F)return;await we();const{scrollContainer:a}=c;Pe(a)?p.value=a:je(a)&&a!==""?p.value=(e=document.querySelector(a))!=null?e:void 0:m.value&&(p.value=We(m.value)),p.value&&(M=B(p,"scroll",K),setTimeout(()=>j(),100))}function D(){!F||!p.value||!K||(M==null||M(),p.value=void 0)}function q(e){if(e.ctrlKey){if(e.deltaY<0)return e.preventDefault(),!1;if(e.deltaY>0)return e.preventDefault(),!1}}function X(){Y.value&&(A=B("wheel",q,{passive:!1}),r=document.body.style.overflow,document.body.style.overflow="hidden",h.value=!0,N("show"))}function W(){A==null||A(),document.body.style.overflow=r,h.value=!1,N("close")}function G(e){N("switch",e)}return ue(()=>c.src,()=>{P.value?(C.value=!0,E.value=!1,D(),Z()):$()}),ye(()=>{P.value?Z():$()}),(e,a)=>(w(),S("div",{ref_key:"container",ref:m,class:u([t(L).b(),e.$attrs.class]),style:de(t(te))},[E.value?J(e.$slots,"error",{key:0},()=>[g("div",{class:u(t(L).e("error"))},Fe(t(O)("el.image.error")),3)]):(w(),S(Q,{key:1},[T.value!==void 0?(w(),S("img",He({key:0},t(ae),{src:T.value,loading:e.loading,style:t(ne),class:t(H),onClick:X,onLoad:le,onError:oe}),null,16,la)):z("v-if",!0),C.value?(w(),S("div",{key:1,class:u(t(L).e("wrapper"))},[J(e.$slots,"placeholder",{},()=>[g("div",{class:u(t(L).e("placeholder"))},null,2)])],2)):z("v-if",!0)],64)),t(Y)?(w(),S(Q,{key:2},[h.value?(w(),ce(t(ta),{key:0,"z-index":e.zIndex,"initial-index":t(se),infinite:e.infinite,"zoom-rate":e.zoomRate,"min-scale":e.minScale,"max-scale":e.maxScale,"url-list":e.previewSrcList,"hide-on-click-modal":e.hideOnClickModal,teleported:e.previewTeleported,"close-on-press-escape":e.closeOnPressEscape,onClose:W,onSwitch:G},{default:_(()=>[e.$slots.viewer?(w(),S("div",oa,[J(e.$slots,"viewer")])):z("v-if",!0)]),_:3},8,["z-index","initial-index","infinite","zoom-rate","min-scale","max-scale","url-list","hide-on-click-modal","teleported","close-on-press-escape"])):z("v-if",!0)],64)):z("v-if",!0)],6))}});var ua=be(ia,[["__file","image.vue"]]);const pa=ke(ua);export{pa as E};
